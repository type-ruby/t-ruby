<!-- Follows Document Simplification Principle: max 200 lines -->

# t-ruby 言語仕様書（ドラフト）

> **本ドキュメントはt-ruby言語の初期仕様ドラフトです。**
> TypeScriptとRubyの哲学を組み合わせ、Ruby上でオプショナルな静的型システムを提供するt-rubyの構造と設計方針を記述します。

**翻訳:** [English](./README.md) | [한국어](./README.ko.md)

---

## 1. 概要

t-rubyはRuby上で動作する**オプショナル/段階的型レイヤー（Optional/Gradual Type System）**です。
`trc`コンパイラが`.trb`ソースファイルを以下の形式に変換します：

* 実行可能なRubyコード（`.rb`）
* Rubyシグネチャファイル（`.rbs`）
* t-ruby高度な宣言ファイル（`.d.trb`）

この言語はRubyの文法と精神を維持しながら、TypeScriptの開発体験（DX）を導入して「選択可能な静的型付け」を提供します。

---

## 2. 言語哲学

1. **Rubyを置き換えない** — t-rubyは別の型レイヤーであり、Rubyがランタイムです。
2. **段階的導入可能** — 部分的な`.trb`導入→プロジェクト全体への移行が可能です。
3. **TypeScriptレベルのDX** — 型システム、インターフェース、ジェネリクス、ユニオン/インターセクション、推論をサポート；IDE親和的。
4. **RBS互換性** — t-rubyはRBSスーパーセットを目指し、投影時はRBSスコープに簡素化されます。
5. **Ruby文化の尊重** — YAMLベース設定（`trbconfig.yml`）；Ruby開発者に自然な文法。

---

## 3. ファイル構造と拡張子

| 拡張子 | 意味 | 説明 |
|--------|------|------|
| `.trb` | t-rubyソース | 開発者が作成する基本単位 |
| `.rb` | コンパイル済みRuby | Rubyランタイム用実行出力 |
| `.rbs` | Rubyシグネチャ | RBSエコシステム連携、保守的な型投影 |
| `.d.trb` | t-ruby宣言 | t-ruby高度な型を完全保存 |
| `trbconfig.yml` | 設定ファイル | t-rubyコンパイル設定 |

---

## 4. コンパイルパイプライン

```
           （開発者が作成）
               *.trb
                   │
                   ▼
            trc（t-rubyコンパイラ）
                   │
      ┌────────────┴────────────────┐
      ▼                             ▼
   *.rb                         *.rbs（オプション）
（実行コード）            （RBSスコープ内型投影）

      ▼
 *.d.trb（オプション）
（t-ruby高度な型）
```

### 4.1 `.rb`出力ルール

* 型関連要素は**すべて削除**。
* Ruby文法を壊さない方法で変換。
* Ruby 3.x文法をターゲット。

### 4.2 `.rbs`出力ルール

* RBSフォーマットに保守的に投影。
* 高度な型（条件付き、マッピング）は簡素化または`untyped`に降格。

### 4.3 `.d.trb`出力ルール

* t-ruby高度な型システムの**完全な形式**を含む。
* `.trb`ファイルから再構成された洗練された宣言。
* IDE/LSP/静的解析ツールによる高度な分析が可能。

---

## 5. 詳細仕様

詳細仕様は以下のドキュメントを参照してください：

| ドキュメント | 内容 |
|-------------|------|
| [文法仕様](./syntax.md) | 関数、型注釈、型エイリアス、インターフェース、ジェネリクス |
| [型システム](./type-system.md) | RBSサブセット、高度な型、静的解析、エラーモデル |
| [ASTモデル](./ast.md) | AST構造とノードタイプ |

---

## 6. 標準ライブラリ型（ドラフト）

Rubyコアオブジェクトの最小型定義を提供：

```trb
type String = builtin
interface Enumerable[T]
  def map(): Array[T]
end
```

標準型宣言はRBSから自動変換または手動定義可能。

---

## 7. 将来の拡張計画

* モジュール/クラス型サポート
* trait-like mixinタイプモデル
* マクロベースの型ジェネレーター
* 高度な推論エンジン
* Ruby 3パターンマッチングと静的型の連携

---

## 8. バージョン管理とスペック規約

* `v0.x`：実験的段階、文法/型は変更可能
* `v1.0`：安定した言語仕様リリース
* 公式スペックドキュメントは英語、韓国語、日本語で提供

---

## 9. ライセンス

本仕様ドキュメントのライセンスは今後決定予定（TBD）。
